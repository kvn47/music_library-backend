(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["99de5a44"],{"097d":function(t,e,a){"use strict";var r=a("5ca1"),n=a("8378"),s=a("7726"),o=a("ebd6"),l=a("bcaa");r(r.P+r.R,"Promise",{finally:function(t){var e=o(this,n.Promise||s.Promise),a="function"==typeof t;return this.then(a?function(a){return l(e,t()).then(function(){return a})}:t,a?function(a){return l(e,t()).then(function(){throw a})}:t)}})},"4e1d":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{staticClass:"q-mb-sm",attrs:{color:"white","text-color":"black"}},[a("q-card-section",[a("q-input",{attrs:{label:"Album Artist"},model:{value:t.album.album_artist,callback:function(e){t.$set(t.album,"album_artist",e)},expression:"album.album_artist"}}),t.album.mb_artists?[a("q-btn",{attrs:{label:t.album.mb_artists,icon:"fas fa-check",color:"accent",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_artists}})]:t._e(),a("q-select",{attrs:{options:t.artist_options,"input-debounce":"1000","use-input":"","hide-selected":"","fill-input":""},on:{filter:t.search_artist},scopedSlots:t._u([{key:"append",fn:function(){return[null!==t.album.artist?a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"clear"},on:{click:function(e){return e.stopPropagation(),t.clear_artist(e)}}}):t._e()]},proxy:!0},{key:"no-option",fn:function(){return[a("q-item",[a("q-item-section",{staticClass:"text-grey"},[t._v("\n            No result\n          ")])],1)]},proxy:!0}]),model:{value:t.album.artist,callback:function(e){t.$set(t.album,"artist",e)},expression:"album.artist"}}),t.album.mb_composer?[a("q-btn",{attrs:{label:t.album.mb_composer,icon:"fas fa-check",color:"accent",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_composer}}),a("a",{staticClass:"q-ml-sm",attrs:{href:t.album.mb_composer_url,target:"_blank"}},[a("q-icon",{attrs:{name:"fas fa-external-link-alt"}})],1)]:t._e(),a("q-input",{attrs:{label:"Title"},model:{value:t.album.title,callback:function(e){t.$set(t.album,"title",e)},expression:"album.title"}}),t.album.mb_title?[a("q-btn",{attrs:{label:t.album.mb_title,icon:"fas fa-check",color:"accent",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_title}}),a("a",{staticClass:"q-ml-sm",attrs:{href:t.album.mb_url,target:"_blank"}},[a("q-icon",{attrs:{name:"fas fa-external-link-alt"}})],1)]:t._e(),a("q-input",{attrs:{label:"Genre"},model:{value:t.album.genre,callback:function(e){t.$set(t.album,"genre",e)},expression:"album.genre"}}),a("q-input",{attrs:{label:"Year"},model:{value:t.album.year,callback:function(e){t.$set(t.album,"year",e)},expression:"album.year"}}),t.album.mb_date?[a("q-btn",{attrs:{label:t.album.mb_date,icon:"fas fa-check",color:"accent",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_year}})]:t._e(),a("q-select",{attrs:{options:t.cover_options,"float-label":"Cover"},model:{value:t.album.cover,callback:function(e){t.$set(t.album,"cover",e)},expression:"album.cover"}})],2),a("q-expansion-item",{attrs:{label:"Tracks"}},[a("q-list",{attrs:{separator:""}},[t._l(t.album.tracks,function(e,r){return[a("q-item",{key:"track-"+r},[a("q-item-section",[a("q-checkbox",{model:{value:e.checked,callback:function(a){t.$set(e,"checked",a)},expression:"track.checked"}})],1),a("q-item-label",[a("q-item-label",{staticClass:"row gutter-xs",attrs:{header:""}},[a("q-input",{staticClass:"col-1",attrs:{type:"number",min:"1"},model:{value:e.number,callback:function(a){t.$set(e,"number",a)},expression:"track.number"}}),a("q-input",{staticClass:"col",model:{value:e.title,callback:function(a){t.$set(e,"title",a)},expression:"track.title"}})],1),e.mb_title?[a("q-item-label",{attrs:{caption:""}},[a("q-btn",{attrs:{label:e.mb_title,icon:"fas fa-check",color:"accent",size:"form","no-caps":"",flat:""},on:{click:function(a){return t.set_mb_track_title(e)}}}),a("a",{staticClass:"q-ml-sm",attrs:{href:e.mb_url,target:"_blank"}},[a("q-icon",{attrs:{name:"fas fa-external-link-alt"}})],1)],1)]:t._e()],2),a("q-item-section",{attrs:{side:"",right:""}},[a("q-btn",{attrs:{flat:"",color:"negative",icon:"fas fa-minus"},on:{click:function(a){return t.remove_track(e)}}})],1)],1)]})],2)],1),a("q-separator"),a("q-card-actions",{attrs:{align:"around"}},[a("q-btn",{attrs:{loading:t.searching_work,label:"Find work info",color:"info",flat:""},on:{click:t.find_work_info}}),a("q-btn",{attrs:{label:"Split",color:"secondary",flat:""},on:{click:function(e){return t.$emit("split-album")}}})],1)],1)},n=[],s=(a("28a5"),a("7f7f"),a("551c"),a("06db"),a("097d"),{name:"AlbumForm",props:{album:{type:Object,required:!0},images:{type:Array,required:!1}},data:function(){return{searching_work:!1,searching_artist:!1,artist_options:[],artist_mbid:null}},computed:{cover_options:function(){return this.images.map(function(t){return{label:t,value:t}})}},methods:{find_work_info:function(){var t=this;this.searching_work=!0,this.$api.query("find_work_info",{title:this.album.title,artist:this.album.artist,artist_mbid:this.artist_mbid}).then(function(e){console.log(t.album),t.album.mb_composer=e.composer,t.album.mb_composer_url=e.composer_url,t.album.mb_title=e.title,t.album.mb_url=e.url,t.album.mb_date=e.date,e.parts.forEach(function(e){t.album.tracks.forEach(function(t){t.number===e.number&&(t.mb_title=e.title,t.mb_url=e.url)})})}).finally(function(){t.searching_work=!1})},search_artist:function(t,e,a){var r=this;val.length<2?a():this.$api.query("search_artist",{name:t}).then(function(t){e(function(){r.artist_options=t.map(function(t){return{value:t.sort_name,label:t.name,sublabel:"[".concat(t.life_span.begin," - ").concat(t.life_span.end,"]. Country: ").concat(t.country),stamp:t.score,mbid:t.id}})})}).catch(function(){return a()})},select_artist:function(t){this.artist_mbid=t.mbid,this.album.artist=t.label,this.album.mb_composer=t.label,this.album.mb_composer_url="https://musicbrainz.org/artist/".concat(t.mbid)},clear_artist:function(){this.artist_mbid=null,this.album.mb_composer=null,this.album.mb_composer_url=null},set_mb_artists:function(){this.album.album_artist=this.album.mb_artists},set_mb_composer:function(){this.album.artist=this.album.mb_composer},set_mb_title:function(){this.album.title=this.album.mb_title},set_mb_year:function(){this.album.year=this.album.mb_date.split("-")[0]},set_mb_track_title:function(t){t.title=t.mb_title},remove_track:function(t){}}}),o=s,l=a("2877"),i=Object(l["a"])(o,r,n,!1,null,null,null);e["a"]=i.exports},ffc9:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{attrs:{padding:""}},[a("q-stepper",{ref:"stepper",model:{value:t.step,callback:function(e){t.step=e},expression:"step"}},[a("q-step",{attrs:{name:1,done:t.step>1,title:"Preparation"}},[a("q-input",{attrs:{label:"Source path",error:t.source_error,clearable:""},model:{value:t.source,callback:function(e){t.source=e},expression:"source"}}),a("q-tree",{attrs:{nodes:t.source_nodes,"node-key":"full_path",selected:t.source},on:{"lazy-load":t.on_sources_load,"update:selected":function(e){t.source=e}}}),a("q-stepper-navigation",[a("q-btn",{staticClass:"float-right q-mb-lg",attrs:{label:"Prepare",color:"primary"},on:{click:t.prepare}})],1)],1),a("q-step",{attrs:{name:2,title:"Importation"}},[t._l(t.import_sources,function(e,r){return[a("q-list",{key:"source-"+r,attrs:{dense:""}},[a("q-item",[a("q-item-label",[t._v(t._s(e.file))])],1),t._l(e.albums,function(r,n){return[a("album-form",{key:"album-"+n,attrs:{album:r},on:{"split-album":function(a){return t.split_album(r,e)}}})]})],2)]}),a("q-stepper-navigation",[a("div",{staticClass:"float-right q-mb-lg"},[a("q-btn",{staticClass:"on-left",attrs:{label:"Back",flat:""},on:{click:t.step_back}}),a("q-btn",{attrs:{label:"Import",color:"primary"},on:{click:t.perform}})],1)])],2),a("q-inner-loading",{attrs:{visible:t.processing}})],1)],1)},n=[],s=(a("551c"),a("06db"),a("097d"),a("f751"),a("7f7f"),a("02fa")),o=a.n(s),l=a("2f62"),i=a("bc3a"),c=a.n(i),u=c.a.create({baseURL:"http://localhost:5000"}),m=function(t){return new Promise(function(e,a){u.get(t).then(function(t){var a=t.data,r=a.filter(function(t){return"directory"===t.type});e(r)}).catch(function(t){var e;e=void 0===t.response?t.message:"".concat(t.response.status," (").concat(t.response.statusText,")"),a(new Error(e))})})},b=a("4e1d"),f={name:"AlbumsImportPage",components:{AlbumForm:b["a"]},data:function(){return{step:1,source:"",source_error:null,import_sources:[],processing:!1}},computed:o()({},Object(l["d"])({source_nodes:function(t){return t.settings.import_sources.map(function(t){return{label:t,full_path:t,lazy:!0}})}})),methods:o()({},Object(l["b"])(["prepare_albums_import","perform_albums_import"]),{on_sources_load:function(t){var e=t.node,a=(t.key,t.done),r=t.fail;m(e.full_path).then(function(t){var r=t.map(function(t){var a="".concat(e.full_path,"/").concat(t.name);return{label:t.name,lazy:!0,full_path:a}});a(r)}).catch(function(t){r(console.log(t))})},step_back:function(){this.$refs.stepper.previous()},step_forward:function(){this.$refs.stepper.next()},remove_track:function(t){},split_album:function(t,e){var a=t.tracks,r=[];t.tracks=[],a.forEach(function(e){e.checked?(e.checked=!1,e.number=r.length+1,r.push(e)):t.tracks.push(e)});var n=Object.assign({},t,{tracks:r});e.albums.push(n)},prepare:function(){var t=this;this.processing=!0,this.prepare_albums_import(this.source).then(function(e){e.forEach(function(t){t.albums.forEach(function(t){t.tracks.forEach(function(t){t.checked=!1})})}),t.import_sources=e,t.step_forward()}).finally(function(){t.processing=!1})},perform:function(){var t=this;this.processing=!0,this.perform_albums_import({path:this.source,import_sources:this.import_sources}).then(function(e){console.log(e),t.step_forward(),t.import_sources=[]}).finally(function(){t.processing=!1})}})},p=f,_=a("2877"),h=Object(_["a"])(p,r,n,!1,null,null,null);e["default"]=h.exports}}]);