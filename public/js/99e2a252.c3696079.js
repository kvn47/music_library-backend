(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["99e2a252"],{"097d":function(t,e,a){"use strict";var n=a("5ca1"),r=a("8378"),i=a("7726"),s=a("ebd6"),o=a("bcaa");n(n.P+n.R,"Promise",{finally:function(t){var e=s(this,r.Promise||i.Promise),a="function"==typeof t;return this.then(a?function(a){return o(e,t()).then(function(){return a})}:t,a?function(a){return o(e,t()).then(function(){throw a})}:t)}})},"4e1d":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{staticClass:"q-mb-sm",attrs:{color:"white","text-color":"black"}},[a("q-card-section",[a("q-select",{attrs:{label:"Artist",value:t.album.artist,options:t.artist_options,hint:"id: "+t.album.artist.id+", mb_id: "+t.album.artist.mb_id,loading:t.searching_artist,"option-label":"name","input-debounce":"1000","use-input":""},on:{input:t.select_artist,filter:t.search_artist},scopedSlots:t._u([{key:"option",fn:function(e){return[a("q-item",t._g(t._b({},"q-item",e.itemProps,!1),e.itemEvents),[a("q-item-section",[a("q-item-label",[t._v(t._s(e.opt.value))]),a("q-item-label",{attrs:{overline:""}},[t._v(t._s(e.opt.label))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(e.opt.details))])],1),a("q-item-section",{attrs:{side:""}},[t._v(t._s(e.opt.score))])],1)]}},{key:"append",fn:function(e){return[null!==t.album.artist?a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"clear"},on:{click:function(e){return e.stopPropagation(),t.clear_artist(e)}}}):t._e()]}},{key:"no-option",fn:function(){return[a("q-item",[a("q-item-section",{staticClass:"text-grey"},[t._v("\n            No result\n          ")])],1)]},proxy:!0}])}),t.album.mb_composer?[a("q-btn",{attrs:{label:t.album.mb_composer,icon:"fas fa-check",color:"accent",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_composer}}),a("a",{staticClass:"q-ml-sm",attrs:{href:t.album.mb_composer_url,target:"_blank"}},[a("q-icon",{attrs:{name:"fas fa-external-link-alt"}})],1)]:t._e(),a("q-input",{attrs:{label:"Album Artist"},model:{value:t.album.album_artist,callback:function(e){t.$set(t.album,"album_artist",e)},expression:"album.album_artist"}}),t.album.mb_artists?[a("q-btn",{attrs:{label:t.album.mb_artists,icon:"fas fa-check",color:"accent",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_artists}})]:t._e(),a("q-input",{attrs:{label:"Title"},model:{value:t.album.title,callback:function(e){t.$set(t.album,"title",e)},expression:"album.title"}}),t.album.mb_title?[a("q-btn",{attrs:{label:t.album.mb_title,icon:"fas fa-check",color:"accent",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_title}}),a("a",{staticClass:"q-ml-sm",attrs:{href:t.album.mb_url,target:"_blank"}},[a("q-icon",{attrs:{name:"fas fa-external-link-alt"}})],1)]:t._e(),a("q-input",{attrs:{label:"Genre"},model:{value:t.album.genre,callback:function(e){t.$set(t.album,"genre",e)},expression:"album.genre"}}),a("q-input",{attrs:{label:"Year"},model:{value:t.album.year,callback:function(e){t.$set(t.album,"year",e)},expression:"album.year"}}),t.album.mb_date?[a("q-btn",{attrs:{label:t.album.mb_date,icon:"fas fa-check",color:"accent",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_year}})]:t._e(),a("q-select",{attrs:{options:t.cover_options,label:"Cover"},model:{value:t.album.cover,callback:function(e){t.$set(t.album,"cover",e)},expression:"album.cover"}})],2),a("q-expansion-item",{attrs:{label:"Tracks","switch-toggle-side":""}},[a("q-list",{attrs:{separator:""}},[t._l(t.album.tracks,function(e,n){return[a("q-item",{key:"track-"+n},[a("q-item-section",{attrs:{side:""}},[a("q-checkbox",{model:{value:e.checked,callback:function(a){t.$set(e,"checked",a)},expression:"track.checked"}})],1),a("q-item-section",[a("div",{staticClass:"row gutter-xs"},[a("q-input",{staticClass:"col-1",attrs:{type:"number",min:"1"},model:{value:e.number,callback:function(a){t.$set(e,"number",a)},expression:"track.number"}}),a("q-input",{staticClass:"col",model:{value:e.title,callback:function(a){t.$set(e,"title",a)},expression:"track.title"}})],1),e.mb_title?[a("div",[a("q-btn",{attrs:{label:e.mb_title,icon:"fas fa-check",color:"accent",size:"form","no-caps":"",flat:""},on:{click:function(a){return t.set_mb_track_title(e)}}}),a("a",{staticClass:"q-ml-sm",attrs:{href:e.mb_url,target:"_blank"}},[a("q-icon",{attrs:{name:"fas fa-external-link-alt"}})],1)],1)]:t._e()],2),a("q-item-section",{attrs:{side:"",right:""}},[a("q-btn",{attrs:{icon:"fas fa-minus",color:"negative",flat:""},on:{click:function(a){return t.remove_track(e)}}})],1)],1)]})],2)],1),a("q-separator"),a("q-card-actions",{attrs:{align:"around"}},[a("q-btn",{attrs:{loading:t.searching_work,label:"Find work info",color:"info",flat:""},on:{click:t.find_work_info}}),a("q-btn",{attrs:{label:"Split",color:"secondary",flat:""},on:{click:function(e){return t.$emit("split-album")}}})],1)],1)},r=[],i=(a("28a5"),a("7f7f"),a("551c"),a("06db"),a("097d"),{name:"AlbumForm",props:{album:{type:Object,required:!0},images:{type:Array,required:!1,default:function(){return[]}}},data:function(){return{searching_work:!1,searching_artist:!1,artist_options:[]}},computed:{cover_options:function(){return this.images.map(function(t){return{label:t,value:t}})}},methods:{find_work_info:function(){var t=this;this.searching_work=!0,this.$api.query("find_work_info",{title:this.album.title,artist:this.album.artist,artist_mb_id:this.artist.mb_id}).then(function(e){console.log(t.album),t.album.mb_composer=e.composer,t.album.mb_composer_url=e.composer_url,t.album.mb_title=e.title,t.album.mb_url=e.url,t.album.mb_date=e.date,e.parts.forEach(function(e){t.album.tracks.forEach(function(t){t.number===e.number&&(t.mb_title=e.title,t.mb_url=e.url)})})}).finally(function(){t.searching_work=!1})},search_artist:function(t,e,a){var n=this;if(t.length<2){if(this.album.artist.name.length<2)return a(),void(this.searching_artist=!1);t=this.album.artist.name}this.searching_artist=!0,this.$api.query("artists",{name:t}).then(function(r){r.length>0?e(function(){n.artist_options=r.map(function(t){return{value:t.name,label:t.name}})}):n.$api.query("mb_artists",{name:t}).then(function(t){e(function(){n.artist_options=t.map(function(t){return{value:t.name,label:t.sort_name,details:"[".concat(t.life_span.begin," - ").concat(t.life_span.end,"]. Country: ").concat(t.country),score:t.score,mb_id:t.id}})})}).catch(function(){return a()})}).catch(function(){return a()}).finally(function(){n.searching_artist=!1})},select_artist:function(t){this.album.artist.name=t.label,this.album.artist.id=t.id,this.album.artist.mb_id=t.mb_id,this.album.mb_composer=t.label,this.album.mb_composer_url="https://musicbrainz.org/artist/".concat(t.mb_id)},clear_artist:function(){this.album.artist.id=null,this.album.artist.name=null,this.album.artist.mb_id=null,this.album.mb_composer=null,this.album.mb_composer_url=null},set_mb_artists:function(){this.album.album_artist=this.album.mb_artists},set_mb_composer:function(){this.album.artist=this.album.mb_composer},set_mb_title:function(){this.album.title=this.album.mb_title},set_mb_year:function(){this.album.year=this.album.mb_date.split("-")[0]},set_mb_track_title:function(t){t.title=t.mb_title},remove_track:function(t){}}}),s=i,o=a("2877"),l=Object(o["a"])(s,n,r,!1,null,null,null);e["a"]=l.exports},c1bc:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{attrs:{padding:""}},[a("q-stepper",{ref:"stepper",model:{value:t.step,callback:function(e){t.step=e},expression:"step"}},[a("q-step",{attrs:{name:1,done:t.step>1,title:"Preparation"}},[a("q-input",{attrs:{label:"Source path",error:t.source_error,clearable:""},model:{value:t.source,callback:function(e){t.source=e},expression:"source"}}),a("q-tree",{attrs:{nodes:t.source_nodes,"node-key":"full_path",selected:t.source},on:{"lazy-load":t.on_sources_load,"update:selected":function(e){t.source=e}}}),a("q-stepper-navigation",[a("q-btn",{staticClass:"float-right q-mb-lg",attrs:{label:"Prepare",color:"primary",loading:t.preparing},on:{click:t.prepare}})],1)],1),a("q-step",{attrs:{name:2,title:"Importation"}},[t._l(t.source_infos,function(e,n){return[a("q-list",{key:"source-"+n,attrs:{dense:""}},[a("q-item",[a("q-item-label",[t._v(t._s(e.file))])],1),t._l(e.albums,function(n,r){return[a("album-form",{key:"album-"+r,attrs:{album:n},on:{"split-album":function(a){return t.split_album(n,e)}}})]})],2)]}),a("q-stepper-navigation",[a("div",{staticClass:"float-right q-mb-lg"},[a("q-btn",{staticClass:"on-left",attrs:{label:"Back",flat:""},on:{click:t.step_back}}),a("q-btn",{attrs:{label:"Import",color:"primary",loading:t.importing},on:{click:t.perform}})],1)])],2)],1)],1)},r=[],i=(a("551c"),a("06db"),a("097d"),a("f751"),a("7f7f"),a("02fa")),s=a.n(i),o=a("2f62"),l=a("bc3a"),c=a.n(l),u=c.a.create({baseURL:"http://localhost:5000"}),m=function(t){return new Promise(function(e,a){u.get(t).then(function(t){var a=t.data,n=a.filter(function(t){return"directory"===t.type});e(n)}).catch(function(t){var e;e=void 0===t.response?t.message:"".concat(t.response.status," (").concat(t.response.statusText,")"),a(new Error(e))})})},b=a("4e1d"),f={name:"MusicImportPage",components:{AlbumForm:b["a"]},data:function(){return{step:1,source:"/Users/vova/Music/2004 - Vol.3 (The Subliminal Verses)",source_error:null,source_infos:[],preparing:!1,importing:!1}},computed:s()({},Object(o["e"])({source_nodes:function(t){return t.settings.import_sources.map(function(t){return{label:t,full_path:t,lazy:!0}})}})),methods:{on_sources_load:function(t){var e=t.node,a=(t.key,t.done),n=t.fail;m(e.full_path).then(function(t){var n=t.map(function(t){var a="".concat(e.full_path,"/").concat(t.name);return{label:t.name,lazy:!0,full_path:a}});a(n)}).catch(function(t){n(console.log(t))})},step_back:function(){this.$refs.stepper.previous()},step_forward:function(){this.$refs.stepper.next()},remove_track:function(t){},split_album:function(t,e){var a=t.tracks,n=[];t.tracks=[],a.forEach(function(e){e.checked?(e.checked=!1,e.number=n.length+1,n.push(e)):t.tracks.push(e)});var r=Object.assign({},t,{tracks:n});e.albums.push(r)},prepare:function(){var t=this;this.preparing=!0,this.$api.query("collect_info",{path:this.source}).then(function(e){e.forEach(function(t){t.albums.forEach(function(t){t.artist={name:t.artist,id:null,mb_id:null},t.tracks.forEach(function(t){t.checked=!1})})}),t.source_infos=e,t.step_forward()}).finally(function(){t.preparing=!1})},perform:function(){var t=this;this.importing=!0,this.$api.post("import",{path:this.source,source_infos:this.source_infos}).then(function(e){console.log(e),t.step_forward(),t.source_infos=[]}).finally(function(){t.importing=!1})}}},p=f,_=a("2877"),h=Object(_["a"])(p,n,r,!1,null,null,null);e["default"]=h.exports}}]);