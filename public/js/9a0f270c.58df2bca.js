(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["9a0f270c"],{"097d":function(t,a,e){"use strict";var i=e("5ca1"),n=e("8378"),l=e("7726"),s=e("ebd6"),r=e("bcaa");i(i.P+i.R,"Promise",{finally:function(t){var a=s(this,n.Promise||l.Promise),e="function"==typeof t;return this.then(e?function(e){return r(a,t()).then(function(){return e})}:t,e?function(e){return r(a,t()).then(function(){throw e})}:t)}})},"22d6":function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("q-page",{attrs:{padding:""}},[e("q-card",[e("q-card-section",[e("q-input",{attrs:{label:"Source path",error:t.source_error,clearable:""},model:{value:t.source_path,callback:function(a){t.source_path=a},expression:"source_path"}}),e("q-input",{attrs:{label:"Artist",clearable:""},model:{value:t.artist,callback:function(a){t.artist=a},expression:"artist"}}),e("q-input",{attrs:{label:"Album",clearable:""},model:{value:t.album,callback:function(a){t.album=a},expression:"album"}}),e("q-input",{attrs:{label:"Destination path",clearable:""},model:{value:t.dst_path,callback:function(a){t.dst_path=a},expression:"dst_path"}}),e("br"),e("q-toggle",{staticClass:"q-mt-md",attrs:{label:"Collect MusicBrainz info"},model:{value:t.collect_mb_info,callback:function(a){t.collect_mb_info=a},expression:"collect_mb_info"}}),e("br"),e("q-toggle",{staticClass:"q-mt-md",attrs:{label:"Copy files"},model:{value:t.copy_files,callback:function(a){t.copy_files=a},expression:"copy_files"}})],1),e("q-separator"),e("q-card-actions",{attrs:{align:"around"}},[e("q-btn",{attrs:{disable:""===t.source_path,loading:t.collecting_info,label:"Collect info",color:"secondary"},on:{click:t.collect_info}}),e("q-btn",{attrs:{disable:0===t.source_infos.length,loading:t.organizing,label:"Organize",color:"primary"},on:{click:t.organize}}),e("q-btn",{attrs:{label:"Reset",color:"warning"},on:{click:t.reset}})],1)],1),t._l(t.source_infos,function(a,i){return[e("q-card",{key:"source-"+i,staticClass:"q-mt-md",attrs:{color:"light"}},[e("q-card-section",[t._v("\n        "+t._s(i+1+". "+(a.file||""))+"\n\n        "),a.mb_release?[e("span",{attrs:{slot:"subtitle"},slot:"subtitle"},[e("a",{staticClass:"q-ml-sm",attrs:{href:a.mb_release_url,target:"_blank"}},[t._v("\n              "+t._s(a.mb_release)+"\n              "),e("q-icon",{attrs:{name:"fas fa-external-link-alt",size:"14px"}})],1)])]:t._e()],2),t._l(a.albums,function(i,n){return[e("album-form",{key:"album-"+n,attrs:{album:i,images:a.images},on:{"split-album":function(e){return t.split_album(i,a)}}})]})],2)]})],2)},n=[],l=(e("f751"),e("551c"),e("06db"),e("097d"),e("4e1d")),s={name:"AlbumOrganizerPage",components:{AlbumForm:l["a"]},data:function(){return{source_path:"",source_error:null,source_infos:[],artist:null,album:null,dst_path:"",collect_mb_info:!1,copy_files:!1,collecting_info:!1,organizing:!1}},methods:{collect_info:function(){var t=this;this.organizing||(this.collecting_info=!0,this.$api.query("music_info",{path:this.source_path,artist:this.artist,album:this.album,collect_mb_info:this.collect_mb_info}).then(function(a){a.forEach(function(t){t.albums.forEach(function(t){t.tracks.forEach(function(t){t.checked=!1})})}),t.source_infos=a}).finally(function(){t.collecting_info=!1}))},split_album:function(t,a){var e=t.tracks,i=[];t.tracks=[],e.forEach(function(a){a.checked?(a.checked=!1,a.number=i.length+1,i.push(a)):t.tracks.push(a)});var n=Object.assign({},t,{tracks:i});a.albums.push(n)},organize:function(){var t=this;this.collecting_info||(this.organizing=!0,this.$api.query("organize_files",{path:this.source_path,source_infos:this.source_infos,dst_path:this.dst_path,copy_files:this.copy_files}).finally(function(){t.organizing=!1}))},reset:function(){this.source_infos=[]}}},r=s,o=e("2877"),c=Object(o["a"])(r,i,n,!1,null,null,null);a["default"]=c.exports},"4e1d":function(t,a,e){"use strict";var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("q-card",{staticClass:"q-mb-sm",attrs:{color:"white","text-color":"black"}},[e("q-card-section",[e("q-select",{attrs:{label:"Artist",value:t.album.artist,options:t.artist_options,hint:"id: "+t.album.artist.id+", mb_id: "+t.album.artist.mb_id,loading:t.searching_artist,"option-label":"name","input-debounce":"1000","use-input":""},on:{input:t.select_artist,filter:t.search_artist},scopedSlots:t._u([{key:"option",fn:function(a){return[e("q-item",t._g(t._b({},"q-item",a.itemProps,!1),a.itemEvents),[e("q-item-section",[e("q-item-label",[t._v(t._s(a.opt.value))]),e("q-item-label",{attrs:{overline:""}},[t._v(t._s(a.opt.label))]),e("q-item-label",{attrs:{caption:""}},[t._v(t._s(a.opt.details))])],1),e("q-item-section",{attrs:{side:""}},[t._v(t._s(a.opt.score))])],1)]}},{key:"append",fn:function(a){return[null!==t.album.artist?e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"clear"},on:{click:function(a){return a.stopPropagation(),t.clear_artist(a)}}}):t._e()]}},{key:"no-option",fn:function(){return[e("q-item",[e("q-item-section",{staticClass:"text-grey"},[t._v("\n            No result\n          ")])],1)]},proxy:!0}])}),t.album.mb_composer?[e("q-btn",{attrs:{label:t.album.mb_composer,icon:"fas fa-check",color:"accent",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_composer}}),e("a",{staticClass:"q-ml-sm",attrs:{href:t.album.mb_composer_url,target:"_blank"}},[e("q-icon",{attrs:{name:"fas fa-external-link-alt"}})],1)]:t._e(),e("q-input",{attrs:{label:"Album Artist"},model:{value:t.album.album_artist,callback:function(a){t.$set(t.album,"album_artist",a)},expression:"album.album_artist"}}),t.album.mb_artists?[e("q-btn",{attrs:{label:t.album.mb_artists,icon:"fas fa-check",color:"accent",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_artists}})]:t._e(),e("q-input",{attrs:{label:"Title"},model:{value:t.album.title,callback:function(a){t.$set(t.album,"title",a)},expression:"album.title"}}),t.album.mb_title?[e("q-btn",{attrs:{label:t.album.mb_title,icon:"fas fa-check",color:"accent",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_title}}),e("a",{staticClass:"q-ml-sm",attrs:{href:t.album.mb_url,target:"_blank"}},[e("q-icon",{attrs:{name:"fas fa-external-link-alt"}})],1)]:t._e(),e("q-input",{attrs:{label:"Genre"},model:{value:t.album.genre,callback:function(a){t.$set(t.album,"genre",a)},expression:"album.genre"}}),e("q-input",{attrs:{label:"Year"},model:{value:t.album.year,callback:function(a){t.$set(t.album,"year",a)},expression:"album.year"}}),t.album.mb_date?[e("q-btn",{attrs:{label:t.album.mb_date,icon:"fas fa-check",color:"accent",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_year}})]:t._e(),e("q-select",{attrs:{options:t.cover_options,label:"Cover"},model:{value:t.album.cover,callback:function(a){t.$set(t.album,"cover",a)},expression:"album.cover"}})],2),e("q-expansion-item",{attrs:{label:"Tracks","switch-toggle-side":""}},[e("q-list",{attrs:{separator:""}},[t._l(t.album.tracks,function(a,i){return[e("q-item",{key:"track-"+i},[e("q-item-section",{attrs:{side:""}},[e("q-checkbox",{model:{value:a.checked,callback:function(e){t.$set(a,"checked",e)},expression:"track.checked"}})],1),e("q-item-section",[e("div",{staticClass:"row gutter-xs"},[e("q-input",{staticClass:"col-1",attrs:{type:"number",min:"1"},model:{value:a.number,callback:function(e){t.$set(a,"number",e)},expression:"track.number"}}),e("q-input",{staticClass:"col",model:{value:a.title,callback:function(e){t.$set(a,"title",e)},expression:"track.title"}})],1),a.mb_title?[e("div",[e("q-btn",{attrs:{label:a.mb_title,icon:"fas fa-check",color:"accent",size:"form","no-caps":"",flat:""},on:{click:function(e){return t.set_mb_track_title(a)}}}),e("a",{staticClass:"q-ml-sm",attrs:{href:a.mb_url,target:"_blank"}},[e("q-icon",{attrs:{name:"fas fa-external-link-alt"}})],1)],1)]:t._e()],2),e("q-item-section",{attrs:{side:"",right:""}},[e("q-btn",{attrs:{icon:"fas fa-minus",color:"negative",flat:""},on:{click:function(e){return t.remove_track(a)}}})],1)],1)]})],2)],1),e("q-separator"),e("q-card-actions",{attrs:{align:"around"}},[e("q-btn",{attrs:{loading:t.searching_work,label:"Find work info",color:"info",flat:""},on:{click:t.find_work_info}}),e("q-btn",{attrs:{label:"Split",color:"secondary",flat:""},on:{click:function(a){return t.$emit("split-album")}}})],1)],1)},n=[],l=(e("28a5"),e("7f7f"),e("551c"),e("06db"),e("097d"),{name:"AlbumForm",props:{album:{type:Object,required:!0},images:{type:Array,required:!1,default:function(){return[]}}},data:function(){return{searching_work:!1,searching_artist:!1,artist_options:[]}},computed:{cover_options:function(){return this.images.map(function(t){return{label:t,value:t}})}},methods:{find_work_info:function(){var t=this;this.searching_work=!0,this.$api.query("find_work_info",{title:this.album.title,artist:this.album.artist,artist_mb_id:this.artist.mb_id}).then(function(a){console.log(t.album),t.album.mb_composer=a.composer,t.album.mb_composer_url=a.composer_url,t.album.mb_title=a.title,t.album.mb_url=a.url,t.album.mb_date=a.date,a.parts.forEach(function(a){t.album.tracks.forEach(function(t){t.number===a.number&&(t.mb_title=a.title,t.mb_url=a.url)})})}).finally(function(){t.searching_work=!1})},search_artist:function(t,a,e){var i=this;if(t.length<2){if(this.album.artist.name.length<2)return e(),void(this.searching_artist=!1);t=this.album.artist.name}this.searching_artist=!0,this.$api.query("artists",{name:t}).then(function(n){n.length>0?a(function(){i.artist_options=n.map(function(t){return{value:t.name,label:t.name}})}):i.$api.query("mb_artists",{name:t}).then(function(t){a(function(){i.artist_options=t.map(function(t){return{value:t.name,label:t.sort_name,details:"[".concat(t.life_span.begin," - ").concat(t.life_span.end,"]. Country: ").concat(t.country),score:t.score,mb_id:t.id}})})}).catch(function(){return e()})}).catch(function(){return e()}).finally(function(){i.searching_artist=!1})},select_artist:function(t){this.album.artist.name=t.label,this.album.artist.id=t.id,this.album.artist.mb_id=t.mb_id,this.album.mb_composer=t.label,this.album.mb_composer_url="https://musicbrainz.org/artist/".concat(t.mb_id)},clear_artist:function(){this.album.artist.id=null,this.album.artist.name=null,this.album.artist.mb_id=null,this.album.mb_composer=null,this.album.mb_composer_url=null},set_mb_artists:function(){this.album.album_artist=this.album.mb_artists},set_mb_composer:function(){this.album.artist=this.album.mb_composer},set_mb_title:function(){this.album.title=this.album.mb_title},set_mb_year:function(){this.album.year=this.album.mb_date.split("-")[0]},set_mb_track_title:function(t){t.title=t.mb_title},remove_track:function(t){}}}),s=l,r=e("2877"),o=Object(r["a"])(s,i,n,!1,null,null,null);a["a"]=o.exports}}]);