(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["99e2a252"],{"097d":function(t,e,a){"use strict";var r=a("5ca1"),s=a("8378"),n=a("7726"),i=a("ebd6"),o=a("bcaa");r(r.P+r.R,"Promise",{finally:function(t){var e=i(this,s.Promise||n.Promise),a="function"==typeof t;return this.then(a?function(a){return o(e,t()).then(function(){return a})}:t,a?function(a){return o(e,t()).then(function(){throw a})}:t)}})},"4e1d":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{staticClass:"q-mb-sm",attrs:{color:"white","text-color":"black"}},[a("q-card-section",[a("q-select",{attrs:{label:"Artist",value:t.album.artist,options:t.artist_options,loading:t.searching_artist,"option-label":"name","input-debounce":"1000","use-input":"","bottom-slots":""},on:{input:t.select_artist,filter:t.search_artist},scopedSlots:t._u([{key:"option",fn:function(e){return[a("q-item",t._g(t._b({},"q-item",e.itemProps,!1),e.itemEvents),[a("q-item-section",[a("q-item-label",[t._v(t._s(e.opt.value))]),a("q-item-label",{attrs:{overline:""}},[t._v(t._s(e.opt.label))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(e.opt.details))])],1),a("q-item-section",{attrs:{side:""}},[t._v(t._s(e.opt.score))])],1)]}},{key:"append",fn:function(e){return[null!==t.album.artist?a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"clear"},on:{click:function(e){return e.stopPropagation(),t.clear_artist(e)}}}):t._e()]}},{key:"no-option",fn:function(){return[a("q-item",[a("q-item-section",{staticClass:"text-grey"},[t._v("\n            No result\n          ")])],1)]},proxy:!0},{key:"hint",fn:function(){return[a("div",[t._v("\n          "+t._s("id: "+t.album.artist.id+", mb_id: "+t.album.artist.mb_id)+"\n          "),t.album.mb_composer?[a("q-btn",{attrs:{label:t.album.mb_composer,color:"secondary",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_composer}}),a("a",{staticClass:"on-right",attrs:{href:t.album.mb_composer_url,target:"_blank"}},[a("q-icon",{attrs:{name:"fas fa-external-link-alt"}})],1)]:t._e()],2)]},proxy:!0},{key:"before",fn:function(){return[a("q-btn",{attrs:{icon:"fas fa-edit",color:"grey-7",flat:""}},[a("q-popup-edit",{attrs:{buttons:""},model:{value:t.album.artist.name,callback:function(e){t.$set(t.album.artist,"name",e)},expression:"album.artist.name"}},[a("q-input",{attrs:{dense:"",autofocus:""},model:{value:t.album.artist.name,callback:function(e){t.$set(t.album.artist,"name",e)},expression:"album.artist.name"}})],1)],1)]},proxy:!0}])}),a("q-input",{attrs:{label:"Album Artist"},scopedSlots:t._u([{key:"before",fn:function(){return[a("q-btn",{attrs:{icon:"far fa-hand-point-right",color:"grey-7",flat:""},on:{click:t.fill_album_artist}})]},proxy:!0}]),model:{value:t.album.album_artist,callback:function(e){t.$set(t.album,"album_artist",e)},expression:"album.album_artist"}}),t.album.mb_artists?[a("q-btn",{attrs:{label:t.album.mb_artists,color:"secondary",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_artists}})]:t._e(),a("q-input",{attrs:{label:"Title"},model:{value:t.album.title,callback:function(e){t.$set(t.album,"title",e)},expression:"album.title"}}),t.album.mb_title?[a("q-btn",{attrs:{label:t.album.mb_title,color:"secondary",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_title}}),a("a",{staticClass:"on-right",attrs:{href:t.album.mb_url,target:"_blank"}},[a("q-icon",{attrs:{name:"fas fa-external-link-alt"}})],1)]:t._e(),a("q-input",{attrs:{label:"Genre"},model:{value:t.album.genre,callback:function(e){t.$set(t.album,"genre",e)},expression:"album.genre"}}),a("q-input",{attrs:{label:"Year"},model:{value:t.album.year,callback:function(e){t.$set(t.album,"year",e)},expression:"album.year"}}),t.album.mb_date?[a("q-btn",{attrs:{label:t.album.mb_date,color:"secondary",size:"form","no-caps":"",flat:""},on:{click:t.set_mb_year}})]:t._e(),a("q-select",{attrs:{options:t.images,label:"Cover","emit-value":""},model:{value:t.album.cover,callback:function(e){t.$set(t.album,"cover",e)},expression:"album.cover"}})],2),a("q-expansion-item",{attrs:{label:"Tracks","switch-toggle-side":""}},[a("q-list",{attrs:{separator:""}},[t._l(t.album.tracks,function(e,r){return[a("q-item",{key:"track-"+r},[a("q-item-section",{attrs:{side:""}},[a("q-checkbox",{model:{value:e.checked,callback:function(a){t.$set(e,"checked",a)},expression:"track.checked"}})],1),a("q-item-section",[a("div",{staticClass:"row gutter-xs"},[a("q-input",{staticClass:"col-1",attrs:{type:"number",min:"1"},model:{value:e.number,callback:function(a){t.$set(e,"number",a)},expression:"track.number"}}),a("q-input",{staticClass:"col",model:{value:e.title,callback:function(a){t.$set(e,"title",a)},expression:"track.title"}})],1),e.mb_title?[a("div",[a("q-btn",{attrs:{label:e.mb_title,color:"secondary",size:"form","no-caps":"",flat:""},on:{click:function(a){return t.set_mb_track_title(e)}}}),a("a",{staticClass:"on-right",attrs:{href:e.mb_url,target:"_blank"}},[a("q-icon",{attrs:{name:"fas fa-external-link-alt"}})],1)],1)]:t._e()],2),a("q-item-section",{attrs:{side:"",right:""}},[a("q-btn",{attrs:{icon:"fas fa-minus",color:"negative",flat:""},on:{click:function(a){return t.remove_track(e)}}})],1)],1)]})],2)],1),a("q-separator"),a("q-card-actions",{attrs:{align:"around"}},[a("q-btn",{attrs:{loading:t.searching_work,label:"Find work info",color:"info",flat:""},on:{click:t.find_work_info}}),a("q-btn",{attrs:{label:"Split",color:"secondary",flat:""},on:{click:function(e){return t.$emit("split-album")}}})],1)],1)},s=[],n=(a("28a5"),a("7f7f"),a("551c"),a("06db"),a("097d"),{name:"AlbumForm",props:{album:{type:Object,required:!0},images:{type:Array,required:!1,default:function(){return[]}}},data:function(){return{searching_work:!1,searching_artist:!1,artist_options:[]}},methods:{find_work_info:function(){var t=this;this.searching_work=!0,this.$api.query("work_info",{title:this.album.title,artist:this.album.artist.name,artist_mb_id:this.album.artist.mb_id}).then(function(e){console.log(t.album),t.album.mb_composer=e.composer,t.album.mb_composer_url=e.composer_url,t.album.mb_title=e.title,t.album.mb_url=e.url,t.album.mb_date=e.date,e.parts.forEach(function(e){t.album.tracks.forEach(function(t){t.number===e.number&&(t.mb_title=e.title,t.mb_url=e.url)})})}).finally(function(){t.searching_work=!1})},search_artist:function(t,e,a){var r=this;if(t.length<2){if(this.album.artist.name.length<2)return a(),void(this.searching_artist=!1);t=this.album.artist.name}this.searching_artist=!0,this.$api.query("artists",{name:t}).then(function(s){s.length>0?e(function(){r.artist_options=s.map(function(t){return{value:t.name,label:t.name,id:t.id,mb_id:t.mb_id}})}):r.$api.query("mb_artists",{name:t}).then(function(t){e(function(){r.artist_options=t.map(function(t){return{value:t.name,label:t.sort_name,details:"[".concat(t.life_span.begin," - ").concat(t.life_span.end,"]. Country: ").concat(t.country),score:t.score,mb_id:t.id}})})}).catch(function(){return a()})}).catch(function(){return a()}).finally(function(){r.searching_artist=!1})},select_artist:function(t){this.album.artist.name=t.label,this.album.artist.id=t.id,this.album.artist.mb_id=t.mb_id,this.album.mb_composer=t.label,this.album.mb_composer_url="https://musicbrainz.org/artist/".concat(t.mb_id)},clear_artist:function(){this.album.artist.id=null,this.album.artist.name=null,this.album.artist.mb_id=null,this.album.mb_composer=null,this.album.mb_composer_url=null},fill_album_artist:function(){this.album.album_artist=this.album.artist.name},set_mb_artists:function(){this.album.album_artist=this.album.mb_artists},set_mb_composer:function(){this.album.artist=this.album.mb_composer},set_mb_title:function(){this.album.title=this.album.mb_title},set_mb_year:function(){this.album.year=this.album.mb_date.split("-")[0]},set_mb_track_title:function(t){t.title=t.mb_title},remove_track:function(t){}}}),i=n,o=a("2877"),l=Object(o["a"])(i,r,s,!1,null,null,null);e["a"]=l.exports},c1bc:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{attrs:{padding:""}},[a("q-stepper",{ref:"stepper",model:{value:t.step,callback:function(e){t.step=e},expression:"step"}},[a("q-step",{attrs:{name:1,done:t.step>1,title:"Preparation"}},[a("q-input",{attrs:{label:"Source path",error:t.source_error,clearable:""},model:{value:t.source,callback:function(e){t.source=e},expression:"source"}}),a("q-tree",{attrs:{nodes:t.source_nodes,"node-key":"full_path",selected:t.source},on:{"lazy-load":t.on_sources_load,"update:selected":function(e){t.source=e}}}),a("q-stepper-navigation",[a("q-btn",{staticClass:"float-right q-mb-lg",attrs:{label:"Prepare",color:"primary",loading:t.preparing},on:{click:t.prepare}})],1)],1),a("q-step",{attrs:{name:2,title:"Importation"}},[t._l(t.source_infos,function(e,r){return[a("q-list",{key:"source-"+r,attrs:{dense:""}},[a("q-item",[a("q-item-label",[t._v(t._s(e.file))])],1),t._l(e.albums,function(r,s){return[a("album-form",{key:"album-"+s,attrs:{album:r,images:e.images},on:{"split-album":function(a){return t.split_album(r,e)}}})]})],2)]}),a("q-stepper-navigation",[a("div",{staticClass:"float-right q-mb-lg"},[a("q-btn",{staticClass:"on-left",attrs:{label:"Back",flat:""},on:{click:t.step_back}}),a("q-btn",{attrs:{label:"Import",disable:t.source_infos.length<1,loading:t.importing,color:"primary"},on:{click:t.perform}})],1)])],2)],1)],1)},s=[],n=(a("8e6e"),a("8a81"),a("ac6a"),a("cadf"),a("456d"),a("551c"),a("06db"),a("097d"),a("f751"),a("7f7f"),a("c47a")),i=a.n(n),o=a("2f62"),l=a("bc3a"),c=a.n(l),u=c.a.create({baseURL:"/fs"}),m=function(t){return new Promise(function(e,a){u.get(t).then(function(t){var a=t.data,r=a.filter(function(t){return"directory"===t.type});e(r)}).catch(function(t){var e;e=void 0===t.response?t.message:"".concat(t.response.status," (").concat(t.response.statusText,")"),a(new Error(e))})})},b=a("4e1d"),f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-dialog",{ref:"logs",attrs:{position:"bottom",seamless:"","full-width":""},on:{hide:t.hide}},[a("q-card",[a("q-linear-progress",{attrs:{value:t.logs_progress}}),a("q-card-section",{staticStyle:{"max-height":"20vh"}},[a("q-scroll-area",{ref:"logs_area",staticStyle:{"min-height":"5rem"}},t._l(t.logs,function(e){return a("p",[t._v(t._s(e))])}),0)],1),a("q-separator"),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{label:"Clear",flat:""},on:{click:t.clear}}),a("q-btn",{attrs:{label:"Hide",flat:""},on:{click:t.hide}})],1)],1)],1)},p=[],_=(a("c5f6"),{name:"ProcessLogs",data:function(){return{logs_connected:!1,logs:[],logs_progress:0,logs_subscription:null}},created:function(){var t=this;this.logs_subscription=this.$cable.subscriptions.create("LogsChannel",{connected:function(){t.logs=[],t.progress=0,t.logs_connected=!0},received:function(e){e["string"]?(t.logs.push(e["string"]),t.$refs.logs_area.setScrollPosition(t.$refs.logs_area.scrollSize-t.$refs.logs_area.containerHeight),t.logs_progress=0):e["progress"]&&(t.logs_progress=Number(e["progress"])/100)}})},beforeDestroy:function(){this.logs_subscription&&this.logs_subscription.unsubscribe()},methods:{show:function(){this.$refs.logs.show()},hide:function(){this.$refs.logs.hide()},clear:function(){this.logs=[],this.logs_progress=0}}}),h=_,d=a("2877"),g=Object(d["a"])(h,f,p,!1,null,null,null),k=g.exports;function q(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,r)}return a}function v(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?q(a,!0).forEach(function(e){i()(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):q(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}var y={name:"MusicImportPage",components:{AlbumForm:b["a"],ProcessLogs:k},data:function(){return{step:1,source:"",source_error:null,source_infos:[],preparing:!1,importing:!1}},computed:v({},Object(o["e"])({source_nodes:function(t){return t.settings.import_sources.map(function(t){return{label:t,full_path:t,lazy:!0}})}})),methods:{on_sources_load:function(t){var e=t.node,a=(t.key,t.done),r=t.fail;m(e.full_path).then(function(t){var r=t.map(function(t){var a="".concat(e.full_path,"/").concat(t.name);return{label:t.name,lazy:!0,full_path:a}});a(r)}).catch(function(t){r(console.log(t))})},step_back:function(){this.$refs.stepper.previous()},step_forward:function(){this.$refs.stepper.next()},remove_track:function(t){},split_album:function(t,e){var a=t.tracks,r=[];t.tracks=[],a.forEach(function(e){e.checked?(e.checked=!1,e.number=r.length+1,r.push(e)):t.tracks.push(e)});var s=JSON.parse(JSON.stringify(Object.assign({},t,{tracks:r})));e.albums.push(s)},prepare:function(){var t=this;this.preparing=!0,this.$api.query("collect_info",{path:this.source}).then(function(e){e.forEach(function(t){t.albums.forEach(function(t){t.artist={name:t.artist,id:null,mb_id:null},t.tracks.forEach(function(t){t.checked=!1})})}),t.source_infos=e,t.step_forward()}).finally(function(){t.preparing=!1})},perform:function(){var t=this;this.importing=!0,this.$q.dialog({component:k}),this.$api.post("import",{path:this.source,source_infos:this.source_infos}).then(function(e){t.$store.commit("success_message",e.result),t.step_forward(),t.source_infos=[]}).finally(function(){t.importing=!1})}}},w=y,x=Object(d["a"])(w,r,s,!1,null,null,null);e["default"]=x.exports}}]);